<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Калькулятор массы металлопроката</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ffffff">

<style>
:root{--b:#e6e6e6;--r:14px}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:18px;max-width:860px;margin-inline:auto}
h1{text-align:center;font-size:22px;margin:8px 0}
.muted{text-align:center;color:#666;font-size:14px;margin-bottom:12px}
.card{border:1px solid var(--b);border-radius:var(--r);padding:14px}
.tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
.tab{border:1px solid var(--b);border-radius:999px;padding:8px 12px;background:#fff;cursor:pointer}
.tab.active{border-color:#111;font-weight:600}
label{display:block;font-size:14px;margin:10px 0 6px}
input,select{width:100%;padding:10px;border:1px solid var(--b);border-radius:12px;font-size:16px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:700px){.row{grid-template-columns:1fr}}
.actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
button{padding:11px 14px;border-radius:12px;border:1px solid var(--b);background:#fff;font-size:16px;cursor:pointer}
button.primary{border-color:#111;font-weight:600}
.out{margin-top:14px;border-top:1px dashed var(--b);padding-top:12px}
.kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media(max-width:700px){.kpi{grid-template-columns:1fr}}
.k{border:1px solid var(--b);border-radius:12px;padding:10px}
.k .t{font-size:13px;color:#666}
.k .v{font-size:20px;font-weight:700;margin-top:4px}
.hint{font-size:13px;color:#666;margin-top:10px}
.small{text-align:center;font-size:12px;color:#666;margin-top:10px}
.err{text-align:center;color:#b00020;margin-top:10px}
</style>
</head>

<body>

<h1>Калькулятор массы металлопроката</h1>
<div class="muted">Работает офлайн • Устанавливается как приложение</div>

<div class="card">

<div class="tabs">
  <button class="tab active" data-mode="round">Круг</button>
  <button class="tab" data-mode="pipe">Труба</button>
  <button class="tab" data-mode="sheet">Лист</button>
  <button class="tab" data-mode="rect">Прямоугольник</button>
</div>

<div class="row">
  <div>
    <label>Материал</label>
    <select id="mat">
      <option value="7850">Сталь (7850)</option>
      <option value="7900">Нержавейка (7900)</option>
      <option value="2700">Алюминий (2700)</option>
      <option value="8960">Медь (8960)</option>
      <option value="8500">Латунь (8500)</option>
      <option value="4500">Титан (4500)</option>
      <option value="custom">Своя плотность</option>
    </select>
  </div>
  <div>
    <label>Плотность кг/м³</label>
    <input id="rho" type="number" value="7850">
  </div>
</div>

<div id="inputs"></div>

<div class="actions">
  <button class="primary" onclick="calc()">Рассчитать</button>
  <button onclick="resetAll()">Сброс</button>
</div>

<div id="error" class="err"></div>

<div class="out" id="out" style="display:none">
  <div class="kpi">
    <div class="k"><div class="t">Масса</div><div class="v" id="m"></div></div>
    <div class="k"><div class="t">Масса 1 м</div><div class="v" id="m1"></div></div>
    <div class="k"><div class="t">Объём</div><div class="v" id="v"></div></div>
  </div>
  <div class="hint" id="f"></div>
</div>

</div>

<script>
const $=id=>document.getElementById(id);
let mode="round";

const modes={
round:{r:()=>`
<div class="row">
 <div><label>Диаметр мм</label><input id="D"></div>
 <div><label>Длина м</label><input id="L"></div>
</div>`,
c:(ρ)=>{
 const D=$("D").value/1000,L=$("L").value;
 const A=Math.PI*D*D/4,V=A*L;
 return{m:ρ*V,v:V,m1:ρ*A,f:"m = ρ · π · (D²/4) · L"};
}},
pipe:{r:()=>`
<div class="row">
 <div><label>Dн мм</label><input id="Dn"></div>
 <div><label>Dв мм</label><input id="Dv"></div>
</div>
<div class="row">
 <div><label>Длина м</label><input id="L"></div>
</div>`,
c:(ρ)=>{
 const Dn=$("Dn").value/1000,Dv=$("Dv").value/1000,L=$("L").value;
 if(Dv>=Dn)throw"Внутр. диаметр больше наружного";
 const A=Math.PI*(Dn*Dn-Dv*Dv)/4,V=A*L;
 return{m:ρ*V,v:V,m1:ρ*A,f:"m = ρ · π · (Dн² − Dв²)/4 · L"};
}},
sheet:{r:()=>`
<div class="row">
 <div><label>Толщина мм</label><input id="t"></div>
 <div><label>Ширина мм</label><input id="B"></div>
</div>
<div class="row">
 <div><label>Длина мм</label><input id="Lmm"></div>
 <div><label>Кол-во</label><input id="N" value="1"></div>
</div>`,
c:(ρ)=>{
 const t=$("t").value/1000,B=$("B").value/1000,L=$("Lmm").value/1000,N=$("N").value;
 const V=t*B*L*N;
 return{m:ρ*V,v:V,m1:null,f:"m = ρ · t · B · L · N"};
}},
rect:{r:()=>`
<div class="row">
 <div><label>a мм</label><input id="a"></div>
 <div><label>b мм</label><input id="b"></div>
</div>
<div class="row">
 <div><label>Длина м</label><input id="L"></div>
 <div><label>Кол-во</label><input id="N" value="1"></div>
</div>`,
c:(ρ)=>{
 const a=$("a").value/1000,b=$("b").value/1000,L=$("L").value,N=$("N").value;
 const A=a*b,V=A*L*N;
 return{m:ρ*V,v:V,m1:ρ*A,f:"m = ρ · a · b · L · N"};
}}
};

function render(){
 document.querySelectorAll(".tab").forEach(t=>t.classList.toggle("active",t.dataset.mode===mode));
 $("inputs").innerHTML=modes[mode].r();
}

document.querySelectorAll(".tab").forEach(t=>t.onclick=()=>{mode=t.dataset.mode;render();});

$("mat").onchange=()=>{
 if($("mat").value==="custom")$("rho").disabled=false;
 else{$("rho").value=$("mat").value;$("rho").disabled=true;}
};

function calc(){
 try{
  const ρ=parseFloat($("rho").value);
  const r=modes[mode].c(ρ);
  $("m").innerText=r.m.toFixed(2)+" кг";
  $("m1").innerText=r.m1? r.m1.toFixed(3)+" кг/м":"—";
  $("v").innerText=r.v.toFixed(6)+" м³";
  $("f").innerText="Формула: "+r.f;
  $("out").style.display="block";
  $("error").innerText="";
 }catch(e){
  $("error").innerText=e;
  $("out").style.display="none";
 }
}

function resetAll(){
 $("inputs").innerHTML="";
 render();
 $("out").style.display="none";
}

if("serviceWorker"in navigator){
 window.addEventListener("load",()=>navigator.serviceWorker.register("sw.js"));
}

render();
</script>

</body>
</html>
