<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Калькулятор массы металлопроката</title>

  <style>
    :root { --b:#e6e6e6; --r:14px; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0; padding:18px; max-width:860px; margin-inline:auto;}
    h1{margin:10px 0 6px; font-size:22px; text-align:center;}
    .muted{color:#666; font-size:14px; text-align:center; margin:0 0 14px;}
    .card{border:1px solid var(--b); border-radius:var(--r); padding:14px; }
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media (max-width:700px){ .row{grid-template-columns:1fr;} }
    label{display:block; font-size:14px; margin:10px 0 6px;}
    input, select{width:100%; padding:10px; border:1px solid var(--b); border-radius:12px; font-size:16px; box-sizing:border-box;}
    .tabs{display:flex; flex-wrap:wrap; gap:8px; margin:0 0 12px;}
    .tab{border:1px solid var(--b); background:#fff; border-radius:999px; padding:9px 12px; cursor:pointer; font-size:14px;}
    .tab.active{border-color:#111; font-weight:600;}
    .actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;}
    button{padding:11px 14px; border-radius:12px; border:1px solid var(--b); background:#fff; cursor:pointer; font-size:16px;}
    button.primary{border-color:#111; font-weight:600;}
    .out{margin-top:14px; border-top:1px dashed var(--b); padding-top:12px;}
    .kpi{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;}
    @media (max-width:700px){ .kpi{grid-template-columns:1fr;} }
    .k{border:1px solid var(--b); border-radius:12px; padding:10px;}
    .k .t{color:#666; font-size:13px;}
    .k .v{font-size:20px; font-weight:700; margin-top:4px;}
    .hint{color:#666; font-size:13px; margin-top:10px;}
    .danger{color:#b00020; font-size:14px; margin-top:10px; text-align:center;}
    .small{font-size:12px; color:#666; text-align:center; margin-top:10px;}
  </style>
</head>

<body>
  <h1>Калькулятор массы металлопроката</h1>
  <p class="muted">Без серверов, работает офлайн. Единицы: мм и м. Результат: кг и т.</p>

  <div class="card">
    <div class="tabs">
      <button class="tab active" data-mode="round">Круг (пруток)</button>
      <button class="tab" data-mode="pipe">Труба</button>
      <button class="tab" data-mode="sheet">Лист</button>
      <button class="tab" data-mode="rect">Прямоугольник</button>
    </div>

    <div class="row">
      <div>
        <label>Материал</label>
        <select id="mat">
          <option value="7850">Сталь (7850)</option>
          <option value="7900">Нержавейка (7900)</option>
          <option value="2700">Алюминий (2700)</option>
          <option value="8960">Медь (8960)</option>
          <option value="8500">Латунь (8500)</option>
          <option value="4500">Титан (4500)</option>
          <option value="custom">Своя плотность…</option>
        </select>
      </div>

      <div>
        <label>Плотность, кг/м³</label>
        <input id="rho" type="number" step="any" value="7850">
      </div>
    </div>

    <!-- Inputs for modes -->
    <div id="inputs"></div>

    <div class="actions">
      <button class="primary" id="calcBtn">Рассчитать</button>
      <button id="resetBtn">Сброс</button>
    </div>

    <div id="err" class="danger"></div>

    <div class="out" id="out" style="display:none;">
      <div class="kpi">
        <div class="k">
          <div class="t">Масса</div>
          <div class="v" id="massKg">—</div>
        </div>
        <div class="k">
          <div class="t">Масса 1 м (если применимо)</div>
          <div class="v" id="massPerM">—</div>
        </div>
        <div class="k">
          <div class="t">Объём</div>
          <div class="v" id="vol">—</div>
        </div>
      </div>
      <div class="hint" id="formula"></div>
      <div class="small">Подсказка: можно поставить как приложение (меню браузера → “Добавить на главный экран”).</div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const modes = {
    round: {
      title: "Круг (пруток)",
      render() {
        return `
          <div class="row">
            <div>
              <label>Диаметр D, мм</label>
              <input id="D" type="number" step="any" placeholder="например 20">
            </div>
            <div>
              <label>Длина L, м</label>
              <input id="L" type="number" step="any" placeholder="например 6">
            </div>
          </div>
        `;
      },
      calc(rho) {
        const Dmm = num("D"), Lm = num("L");
        const D = Dmm/1000;
        const A = Math.PI * (D*D)/4;
        const V = A * Lm;
        const m = rho * V;
        const m1 = rho * A; // per 1 m
        return { m, V, m1, formula: "m = ρ · π · (D²/4) · L" };
      }
    },

    pipe: {
      title: "Труба",
      render() {
        return `
          <div class="row">
            <div>
              <label>Наружный диаметр Dн, мм</label>
              <input id="Dn" type="number" step="any" placeholder="например 50">
            </div>
            <div>
              <label>Внутренний диаметр Dв, мм</label>
              <input id="Dv" type="number" step="any" placeholder="например 40">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Длина L, м</label>
              <input id="L" type="number" step="any" placeholder="например 6">
            </div>
            <div>
              <label>Подсказка</label>
              <input disabled value="Можно вместо Dв считать по толщине, добавим в v2">
            </div>
          </div>
        `;
      },
      calc(rho) {
        const Dnmm = num("Dn"), Dvmm = num("Dv"), Lm = num("L");
        if (Dvmm >= Dnmm) throw new Error("Dв должен быть меньше Dн");
        const Dn = Dnmm/1000, Dv = Dvmm/1000;
        const A = Math.PI * (Dn*Dn - Dv*Dv)/4;
        const V = A * Lm;
        const m = rho * V;
        const m1 = rho * A;
        return { m, V, m1, formula: "m = ρ · π · ((Dн² − Dв²)/4) · L" };
      }
    },

    sheet: {
      title: "Лист",
      render() {
        return `
          <div class="row">
            <div>
              <label>Толщина t, мм</label>
              <input id="t" type="number" step="any" placeholder="например 2">
            </div>
            <div>
              <label>Ширина B, мм</label>
              <input id="B" type="number" step="any" placeholder="например 1000">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Длина L, мм</label>
              <input id="Lmm" type="number" step="any" placeholder="например 2000">
            </div>
            <div>
              <label>Количество, шт</label>
              <input id="N" type="number" step="1" value="1">
            </div>
          </div>
        `;
      },
      calc(rho) {
        const t = num("t")/1000, B = num("B")/1000, L = num("Lmm")/1000, N = num("N");
        const V1 = t*B*L;
        const V = V1*N;
        const m = rho*V;
        return { m, V, m1: null, formula: "m = ρ · t · B · L · N" };
      }
    },

    rect: {
      title: "Прямоугольник",
      render() {
        return `
          <div class="row">
            <div>
              <label>Толщина/высота a, мм</label>
              <input id="a" type="number" step="any" placeholder="например 10">
            </div>
            <div>
              <label>Ширина b, мм</label>
              <input id="b" type="number" step="any" placeholder="например 30">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Длина L, м</label>
              <input id="L" type="number" step="any" placeholder="например 6">
            </div>
            <div>
              <label>Количество, шт</label>
              <input id="N" type="number" step="1" value="1">
            </div>
          </div>
        `;
      },
      calc(rho) {
        const a = num("a")/1000, b = num("b")/1000, Lm = num("L"), N = num("N");
        const A = a*b;
        const V1 = A*Lm;
        const V = V1*N;
        const m = rho*V;
        const m1 = rho*A; // per 1 m (for single bar)
        return { m, V, m1, formula: "m = ρ · a · b · L · N (a,b в метрах)" };
      }
    }
  };

  let mode = "round";

  function num(id){
    const v = parseFloat($(id).value);
    if (Number.isNaN(v) || v <= 0) throw new Error("Проверь поля ввода: все значения должны быть > 0");
    return v;
  }

  function setMode(m){
    mode = m;
    document.querySelectorAll(".tab").forEach(b => b.classList.toggle("active", b.dataset.mode === m));
    $("inputs").innerHTML = modes[m].render();
    $("err").innerText = "";
    $("out").style.display = "none";
    restoreInputs();
  }

  function syncRho(){
    const mat = $("mat").value;
    if (mat === "custom"){
      $("rho").disabled = false;
      $("rho").focus();
    } else {
      $("rho").value = mat;
      $("rho").disabled = true;
    }
  }

  function saveInputs(){
    const data = { mode, mat:$("mat").value, rho:$("rho").value };
    // save any inputs currently on screen
    document.querySelectorAll("#inputs input").forEach(inp => data[inp.id] = inp.value);
    localStorage.setItem("metalcalc_v1", JSON.stringify(data));
  }

  function restoreInputs(){
    const raw = localStorage.getItem("metalcalc_v1");
    if(!raw) return;
    try{
      const data = JSON.parse(raw);
      // restore fields if exist
      if(data.mat){ $("mat").value = data.mat; }
      syncRho();
      if(data.rho && $("mat").value === "custom"){ $("rho").value = data.rho; }
      document.querySelectorAll("#inputs input").forEach(inp => {
        if(data[inp.id] !== undefined) inp.value = data[inp.id];
      });
    } catch(e){}
  }

  function calc(){
    $("err").innerText = "";
    try{
      const rho = parseFloat($("rho").value);
      if(Number.isNaN(rho) || rho <= 0) throw new Error("Плотность должна быть > 0");
      const r = modes[mode].calc(rho);

      $("out").style.display = "block";
      $("massKg").innerText = r.m.toFixed(2) + " кг (" + (r.m/1000).toFixed(3) + " т)";
      $("vol").innerText = r.V.toFixed(6) + " м³";
      $("formula").innerText = "Формула: " + r.formula;

      if (r.m1 === null){
        $("massPerM").innerText = "—";
      } else {
        $("massPerM").innerText = r.m1.toFixed(3) + " кг/м";
      }

      saveInputs();
    } catch(e){
      $("out").style.display = "none";
      $("err").innerText = e.message || "Ошибка";
    }
  }

  function resetAll(){
    localStorage.removeItem("metalcalc_v1");
    $("mat").value = "7850";
    syncRho();
    setMode("round");
    // clear mode inputs
    document.querySelectorAll("#inputs input").forEach(inp => inp.value = "");
    $("err").innerText = "";
    $("out").style.display = "none";
  }

  // Wire up UI
  document.querySelectorAll(".tab").forEach(btn => btn.addEventListener("click", () => setMode(btn.dataset.mode)));
  $("mat").addEventListener("change", () => { syncRho(); saveInputs(); });
  $("rho").addEventListener("input", saveInputs);
  $("calcBtn").addEventListener("click", calc);
  $("resetBtn").addEventListener("click", resetAll);

  // init
  syncRho();
  setMode("round");
</script>

</body>
</html>
